<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Middleware Help | Wildfly / JBoss EAP 7</title>
    <meta http-equiv="X-UA-Compatible" content="IE=firefox">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Middleware Notes.">
    <meta property="og:image" content="http://localhost:4000/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Wildfly / JBoss EAP 7" />
    <meta property="og:description" content="Middleware Notes." />
    <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/highlight.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/cookie-eu-banner.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/custom.css">
    <link rel="canonical" href="http://localhost:4000/docs/jboss-eap-7">
    <link rel="shortcut icon" type="image/x-icon" href="http://localhost:4000/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Middleware Tips" href="http://localhost:4000/feed.xml">
</head>

<body>
<div id="container" class="help page help-home background">
    <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/" class="highlighted"><span>help</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/miservers/miservers.github.io/edit/master/docs/jboss-eap-7.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>


<div class="panel main">
    <div class="panel left">
        <div class="navigation-help" role="navigation">
    <ul>
        <li><h2>Notes</h2></li>
        
        <li >
            
            	<a href="/docs/menu/app-servers" >App Servers</a>
        	
        </li>
        
        <li >
            
            	<a href="/docs/menu/production" >Production</a>
        	
        </li>
        
        <li >
            
            	<a href="http://localhost:4000/discover">Introduction</a>
            
        </li>
        
        <li >
            
            	<a href="/hosting/install" >Installation</a>
        	
        </li>
        
        <li >
            
            	<a href="http://localhost:4000/hosting">Hosting</a>
            
        </li>
        
        <li >
            
            	<a href="http://localhost:4000/configure">Configure</a>
            
        </li>
        
        <li >
            
            	<a href="http://localhost:4000/extend">Extend</a>
            
        </li>
        
        <li >
            
            	<a href="http://localhost:4000/contribute">Contribute</a>
            
        </li>
        
        <li >
            
            	<a href="http://localhost:4000/legal">Small print</a>
            
        </li>
        
    </ul>
</div>
    </div>

	<div class="panel middle">
		<div class="grid grid-responsive-12">
			<div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                
                
            </ul>
        </div>
    </div>
</div>

			
			<p>⚠️ <strong>These notes are based on Jboss EAP 7.4 and Wildfly 29</strong></p>

<p><strong>Table Of Contents</strong></p>
<ol>
  <li><a href="#1-quickstart">QuickStart</a></li>
  <li><a href="#2-domain-setup">Domain Setup</a>
    <ul>
      <li><a href="#domain-controller-configuration">Domain Controller Configuration</a></li>
      <li><a href="#host-controller-configuration">Host Controller Configuration</a></li>
    </ul>
  </li>
  <li><a href="#3-application-deployment">Application deployment</a></li>
  <li><a href="#4-configuration">Configuration</a>
    <ul>
      <li><a href="#41-doamin-configuration-files">Doamin Configuration Files</a></li>
      <li><a href="#42-standalone-configuration-files">Standalone Configuration Files</a></li>
      <li><a href="#43-modules">Modules</a></li>
      <li><a href="#44-jdbc-driver">JDBC Driver</a></li>
      <li><a href="#45-ata-sources">Data Sources</a></li>
      <li><a href="#46-logging">Logging</a></li>
      <li><a href="#47-resource-adapters">Resource Adapters</a></li>
    </ul>
  </li>
  <li><a href="#5-cli">CLI</a></li>
  <li><a href="#6-monitoring">Monitoring</a>
    <ul>
      <li><a href="#health">Health</a></li>
    </ul>
  </li>
  <li><a href="#7-performance-tuning">Performance Tuning</a>
    <ul>
      <li><a href="#71-jvm-settings">JVM Setting</a></li>
      <li><a href="#72-jconsole">JConsole</a></li>
    </ul>
  </li>
  <li><a href="#8-security">Security</a>
    <ul>
      <li><a href="#rbac">RBAC</a></li>
    </ul>
  </li>
  <li><a href="#9-high-availability">High Availability</a>
    <ul>
      <li><a href="#cluster">Cluster</a></li>
    </ul>
  </li>
  <li><a href="#10-miscs">Miscs</a></li>
  <li><a href="#11-common-errors">Common Errors</a></li>
</ol>

<h2 id="1-quickstart"><strong>1. QuickStart</strong></h2>
<h3 id="domain-architecture">Domain Architecture</h3>

<p><img src="./images/Jboss-EAP-7.4.-Domain.drawio.png" alt="jboss" /></p>

<h3 id="standalone">Standalone</h3>
<p><strong>Start/Stop</strong>: Standalone Mode</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./standalone.sh -b 192.168.56.103 -bmanagement 192.168.56.103
 
./jboss-cli.sh --user=jbossadmin --password=Changeit2! 
             --connect --controller=$HOST:9990  command=:shutdown
</code></pre></div></div>

<h3 id="console">Console:</h3>
<blockquote>
  <p>http://HOST:9990/console</p>
</blockquote>

<h3 id="users">Users</h3>
<p>Add Management/Application Users</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./add-user.sh
</code></pre></div></div>

<p><strong>Change Console Password</strong>: Enter the username you want to change the password</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./add-user.sh
</code></pre></div></div>

<h3 id="domain">Domain</h3>
<p><strong>Start/Stop Domain Controller</strong>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./domain.sh -bmanagement 192.168.56.103 --host-config=host-master.xml

CLI:
	/host=master:shutdown
</code></pre></div></div>

<p><strong>Start/Stop Host Controller</strong>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./domain.sh -Djboss.domain.master.address=192.168.56.103 -b 192.168.56.104 --host-config=host-slave.xml

CLI:
	/host=SLAVE_NAME:shutdown
</code></pre></div></div>

<p><strong>Start/Stop Servers</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[domain@centos1:9990 /] /host=centos2/server=server-one:start

Others Operations: stop, restart, reload, read-operation-names
</code></pre></div></div>

<h3 id="cli--memos">CLI : Memos</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./jboss-cli.sh --controller=centos1:9990 --connect
</code></pre></div></div>

<p>CLIs:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Start all servers of a Group
/server-group=myapp-server-group:start-servers 

# Change jvm heap size of a group
 /server-group=myapp-server-group/jvm=default:write-attribute(name=heap-size, value=128m)
</code></pre></div></div>

<h2 id="2-domain-setup"><strong>2. Domain Setup</strong></h2>
<p>A <strong>Domain</strong> consists of a domain controller, host controllers, server groups per host.</p>

<p>A <strong>server group</strong> is a set of server instances, and are managed and configured as one. each server in a group shares the same configuration and deplyments.</p>

<p><strong>Domain controller</strong> is the central process controlling the managed domain.</p>

<p><strong>Host Controller</strong> is launched when  <strong>./domain.sh</strong> is run on a host.</p>

<p>This config example, we have hosts:</p>
<ul>
  <li>centos1(192.168.56.103) : domain controller host(master).</li>
  <li>centos2(192.168.56.104) : slave server host.</li>
</ul>

<h3 id="domain-controller-configuration">Domain Controller Configuration</h3>
<p>Host : centos1(192.168.56.103)</p>

<p>Do steps 1-3 in <strong>host-master.xml</strong> :</p>

<ol>
  <li>
    <p>Choose a logical name of The domain controller: I choose a name <strong>master</strong></p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;host</span> <span class="na">xmlns=</span><span class="s">"urn:jboss:domain:16.0"</span> <span class="na">name=</span><span class="s">"master"</span><span class="nt">&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>a host acts as domain controller via <strong>domain-controller</strong> declaration</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;domain-controller&gt;</span>
 	<span class="nt">&lt;local/&gt;</span>
 <span class="nt">&lt;/domain-controller&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Management Inteface:</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;interface</span> <span class="na">name=</span><span class="s">"management"</span><span class="nt">&gt;</span>
 	    <span class="nt">&lt;inet-address</span> <span class="na">value=</span><span class="s">"${jboss.bind.address.management:192.168.56.103}"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/interface&gt;</span>
</code></pre></div>    </div>

    <p>Or via <em>domain.sh</em> argument : -bmanagement 192.168.56.103</p>
  </li>
  <li>
    <p>On the domain controller, create a new user(by <strong>add-user.sh</strong>) that can be used by slave host(centos2) controllers  to connect on the domain controller. I create a user/slave named <strong>centos2</strong>.</p>
  </li>
  <li>
    <p>Start The Master</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ./domain.sh <span class="nt">-bmanagement</span> 192.168.56.103 <span class="nt">--host-config</span><span class="o">=</span>host-master.xml
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="host-controller-configuration">Host Controller Configuration</h3>
<p>Host: centos2(192.168.56.104)</p>

<p>To join a domain, a host controller configuration require 3 steps:</p>

<p>Do  steps 1-3 in  <strong>host-slave.xml</strong>:</p>

<ol>
  <li>the logical host name needs to be distinct
    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;host</span> <span class="na">xmlns=</span><span class="s">"urn:jboss:domain:16.0"</span> <span class="na">name=</span><span class="s">'centos2'</span><span class="nt">&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Slave needs to know the password of the domain management user:</p>

    <p>Use the hashed password previousely created  in the domain controller:</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;security-realm</span> <span class="na">name=</span><span class="s">"ManagementRealm"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;server-identities&gt;</span>
             <span class="nt">&lt;secret</span> <span class="na">value=</span><span class="s">"Y2hhbmdlaXQ="</span><span class="nt">/&gt;</span>
   		<span class="nt">&lt;/server-identities&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>the Host Controller needs to now the Domain Controller name and IP.</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;domain-controller&gt;</span>
 	....
     <span class="nt">&lt;static-discovery</span> <span class="na">name=</span><span class="s">"master"</span> <span class="na">protocol=</span><span class="s">"${jboss.domain.master.protocol:remote+http}"</span> 
         <span class="na">host=</span><span class="s">"${jboss.domain.master.address}"</span> <span class="na">port=</span><span class="s">"${jboss.domain.master.port:9990}"</span><span class="nt">/&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Start The Slave:</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ./domain.sh <span class="nt">-Djboss</span>.domain.master.address<span class="o">=</span>192.168.56.103 <span class="nt">-b</span> 192.168.56.104 <span class="nt">--host-config</span><span class="o">=</span>host-slave.xml
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="how-to-start-master-and-slave-on-the-same-machine">How To Start Master and Slave on the same Machine</h3>

<p>This is necessary if you want to create server instances on the Machine running the Maser.</p>

<p>⚠️ This is not recommanded!. The domain controller should be on a separated server.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	Domain Controller:
	
	[centos1]$ ./domain.sh -bmanagement 192.168.56.103 --host-config=host-master.xml

	Host Controller:

	[centos1]$ ./domain.sh -Djboss.domain.master.address=192.168.56.103 -b 192.168.56.103 --host-config=host-slave.xml
</code></pre></div></div>

<p>https://www.dbi-services.com/blog/jboss-eap-7-domain-configuration/</p>

<h2 id="3-application-deployment"><strong>3. Application deployment</strong></h2>
<p><strong>Managed Domain</strong></p>

<p>Deploy/Undeploy.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[domain@centos1:9990 /] deploy --server-groups=myapp-server-group /opt/helloworld-jboss.war 
[domain@centos1:9990 /] undeploy --server-groups=myapp-server-group helloworld-jboss.war 
</code></pre></div></div>

<p>Deployment Status:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[domain@centos1:9990 /] /server-group=myapp-server-group/deployment=helloworld-jboss.war:read-resource
</code></pre></div></div>

<p><strong>Standalone server</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[standalone@centos1:9990 /] deploy /opt/jboss-as-helloworld.war

[standalone@centos1:9990 /] undeploy jboss-as-helloworld.war
</code></pre></div></div>

<h2 id="4-configuration"><strong>4. Configuration</strong></h2>
<h3 id="41-doamin-configuration-files">4.1 Doamin Configuration Files</h3>

<ul>
  <li><strong>domain.xml</strong>
    <ul>
      <li>Contains servers settings, profiles, subsystems, deplyments…</li>
      <li>Parsed by domain controller(master), but not by slave hosts controllers. A slave host controller gets its configurations from the remote domain controller when it registers with it.</li>
    </ul>
  </li>
  <li>
    <p><strong>host-master.xml</strong><br />
  It specifies that a host controller should become a domain controller(Master). No servers will be started by the domain controller(recommended in Production).</p>

    <p>$ bin/domain.sh –host-config=host-master.xml</p>
  </li>
  <li>
    <p><strong>host-slave.xml</strong><br />
  It specifies that a host controller should become a Secondary host controller(Slave). It should register with a remote domain controller. This configurartion specifies how many servers to launch, and  what server groups they belong to.</p>

    <p>$ bin/domain.sh –host-config=host-slave.xml</p>
  </li>
  <li><strong>host.xml</strong><br />
  Don’t use it, use the two above config files.</li>
</ul>

<h3 id="42-standalone-configuration-files">4.2 Standalone Configuration Files</h3>
<ul>
  <li><strong>standalone.xml</strong>
    <ul>
      <li>ports: http/8080, management/9990.</li>
      <li>port-offset: default 0. for example, port-offset=100 gives http port 8180 et console 10090.</li>
    </ul>
  </li>
  <li><strong>standalone-ha.xml</strong> <br />
  use this configuration to have clustering.</li>
</ul>

<p>Run the standalone with a specefic config file</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./standalone.sh -c standalone-ha.xml
</code></pre></div></div>

<h3 id="43-modules">4.3 Modules</h3>
<ol>
  <li>
    <p>Add a Module with CLI</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ./jboss-cli.sh --controller=centos1:9990 --connect

 module add --name=org.postgresql --resources=~/postgresql-42.6.0.jar 
         --dependencies=javax.api,javax.transaction.api
</code></pre></div>    </div>
  </li>
</ol>

<p>The jar is copied into <strong>modules/org/postgresql/main/</strong></p>

<ol>
  <li>
    <p>Remove a Module</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> module remove --name=org.postgresql
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="44-jdbc-driver">4.4 JDBC Driver</h3>
<p>Add a JDBC Driver as a Module(Recommended) using CLI:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module add --name=org.postgresql --resources=~/postgresql-42.6.0.jar 
		--dependencies=javax.api,javax.transaction.api

/subsystem=datasources/jdbc-driver=postgres:add(driver-name=postgres, 
						driver-module-name=org.postgresql, 
						driver-class-name=org.postgresql.Driver)
</code></pre></div></div>

<h3 id="45-data-sources">4.5 Data Sources</h3>
<p>Using Console, Easy. You can Test It!</p>

<p>Using CLI</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data-source add --name=PostgresDS --jndi-name=java:/PostgresDS 
		--driver-name=postgres --connection-url=jdbc:postgresql://localhost:5432/postgresdb 
		--user-name=admin --password=admin

reload
</code></pre></div></div>

<p>Test a DataSource</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/subsystem=datasources/data-source=PostgresDS:test-connection-in-pool
</code></pre></div></div>

<p>Remove a Data source</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data-source remove --name=PostgresDS

reload
</code></pre></div></div>

<h3 id="46-logging">4.6 Logging</h3>
<p><strong>logging.properties</strong> : This is logging configuration is used when the server boots up until the logging subsystem kicks in.</p>

<p>Standalone Server</p>
<blockquote>
  <p>./standalone/log/server.log</p>
</blockquote>

<h3 id="47-resource-adapters">4.7 Resource Adapters</h3>
<p>Steps to declare a new resource adapter:</p>
<ol>
  <li>
    <p>Deploy the .rar archive
 Obtain  <strong>wmq.jmsra.rar</strong> in /opt/mqm/java/lib/jca/wmq.jmsra.rar</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> CLI:
	
 deploy --server-groups=myapp-server-group /opt/mqm/java/lib/jca/wmq.jmsra.rar
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add  the resource adapter</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> CLI:

 /profile=full/subsystem=resource-adapters/resource-adapter=wmq.jmsra.rar:add(archive=wmq.jmsra.rar, transaction-support=XATransaction)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Configure IBM MQ Adapter</p>
  </li>
  <li>
    <p>Deploy JMS Test Application(find it in ibm mq installation directory)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> deploy --server-groups=myapp-server-group /opt/mqm/java/lib/jca/wmq.jmsra.ivt.ear
</code></pre></div>    </div>
  </li>
  <li>
    <p>Test</p>
  </li>
</ol>

<h2 id="5-cli"><strong>5. CLI</strong></h2>
<p>https://octopus.com/blog/using-the-wildfly-cli</p>

<p>http://www.jtips.info/WildFly/CLI</p>

<p>Intéractive mode</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./jboss-cli.sh  -c --controller=centos1:9990
</code></pre></div></div>

<p>non-interactive mode:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./jboss-cli.sh -u=jboss -p=pass123  -c --controller=localhost:9990 --commands="cd /core-service,ls"
</code></pre></div></div>

<p>There are two types to interact with the management interface:</p>
<ul>
  <li>High Level <a href="#commands">Commands</a></li>
  <li>Low Level <a href="#operation-requests">Operation Requests</a></li>
</ul>

<h3 id="51-commands">5.1 Commands</h3>
<p>High level interactive mode with management interface.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[domain@centos1:9990 /] help --commands
	deployment-info batch deploy deployment-info  deploy-file undeploy cd shutdown connect 
	data-source xa-data-source reload quit info ...
</code></pre></div></div>

<h3 id="52-operation-requests">5.2 Operation Requests</h3>
<p>Low level interactive mode with management interface.</p>

<p>An Operation request basiquely consists of three parts: <em>address</em>, <em>operation name</em>, and <em>parameters</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[/node-type=node-name(/node-type=node-name)*]:operation-name [([(param-name=param-value)*])]
</code></pre></div></div>

<p>For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/profile=full/subsystem=logging/root-logger=ROOT:write-attribute(name=level, value=INFO)
</code></pre></div></div>

<h3 id="53-tab-completion">5.3 TAB Completion</h3>
<p>Very very useful.</p>

<h3 id="54-main-operations">5.4 Main Operations</h3>
<p><strong>read-operation-names</strong> : List all available operations on a node</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[domain@centos1:9990 /] /host=centos2/server=server-one:read-operation-names
	        ....
	        "read-children-names",
	        "read-children-resources",
	        "read-operation-names",
	        "read-resource",
	        "read-resource-description",
	        "start",
		    "kill",
		    "stop",
	        "write-attribute"
</code></pre></div></div>

<p><strong>read-resource</strong>: Display attributes/values of a resource</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[domain@centos1:9990 /] /server-group=main-server-group:read-resource
		{
		"profile" =&gt; "full",
		"socket-binding-default-interface" =&gt; undefined,
		"socket-binding-port-offset" =&gt; 0,
		"deployment" =&gt; {"jboss-as-helloworld.war" =&gt; undefined},
</code></pre></div></div>

<p><strong>write-attribute</strong> : Modify an attribute value.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[domain@centos1:9990 /] /server-group=main-server-group:write-attribute(name=socket-binding-port-offset, value=100)
</code></pre></div></div>

<h3 id="55-commands-standalone">5.5 Commands Standalone</h3>
<p>TODO</p>

<h3 id="56-commands-in-domain">5.6 Commands in Domain</h3>
<ul>
  <li>
    <p><strong>Subsystems and Profiles</strong> <br />
The main diffence with the standalone, is that subsystems are not located in the root, but in a Profile.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [domain@centos1:9990 /] /profile=full/subsystem=datasources/data-source=ExampleDS:read-resource
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Start/Stop a Server</strong></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [domain@centos1:9990 /] /host=centos2/server=server-one:start

  Others Operations: stop, restart, reload, read-operation-names
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="57-domainxml-and-cli">5.7 domain.xml and CLI</h3>
<p><img src="images/Jboss-EAP-7.4.domain-cli.drawio.png" alt="" /></p>

<h2 id="6-monitoring"><strong>6. Monitoring</strong></h2>
<h3 id="metrics">Metrics</h3>
<p>/extension=org.wildfly.extension.metrics:add</p>

<p>/profile=full/subsystem=metrics:add</p>

<p>/profile=full/subsystem=metrics:read-resource
{
    “outcome” =&gt; “success”,
    “result” =&gt; {
        “exposed-subsystems” =&gt; undefined,
        “prefix” =&gt; undefined,
        “security-enabled” =&gt; true
    }</p>

<p>http://192.168.56.103:9990/metrics</p>

<h3 id="health">Health</h3>
<p>/extension=org.wildfly.extension.health:add</p>

<p>/profile=full/subsystem=health:add</p>

<h2 id="7-performance-tuning"><strong>7. Performance Tuning</strong></h2>
<h3 id="71-jvm-settings">7.1 JVM Settings</h3>
<p><strong>Domain</strong><br />
JVM setting can be defined on different scope: For a Server Group, for a host, or for a specific server.</p>

<p>⚠️ Below configurations should be done on the <a href="http://HOST:9990/console/index.html#runtime">Console &gt; Runtime</a></p>

<ul>
  <li>JVM Setting for a Server Group: <strong>domain.xml</strong><br />
All servers of this group inherit these settings.
    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;server-group</span> <span class="na">name=</span><span class="s">"myapp-server-goup"</span> <span class="na">profile=</span><span class="s">"full"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;jvm</span> <span class="na">name=</span><span class="s">"default"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;heap</span> <span class="na">size=</span><span class="s">"128m"</span> <span class="na">max-size=</span><span class="s">"512m"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/jvm&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>JVM Setting for a host: <strong>host-slave.xml</strong> <br />
These settings will be used if no setting are defined for the server group and for the server.
    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;jvms&gt;</span>
      <span class="nt">&lt;jvm</span> <span class="na">name=</span><span class="s">"default"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;heap</span> <span class="na">size=</span><span class="s">"64m"</span> <span class="na">max-size=</span><span class="s">"256m"</span><span class="nt">/&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>JVM Setting for a specific server: <strong>host-slave.xml</strong>  <br />
If defined, these settings have priority.
    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;server</span> <span class="na">name=</span><span class="s">"srv1"</span> <span class="na">group=</span><span class="s">"myapp-server-goup"</span> <span class="na">auto-start=</span><span class="s">"false"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;jvm</span> <span class="na">name=</span><span class="s">"default"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;heap</span> <span class="na">size=</span><span class="s">"128m"</span> <span class="na">max-size=</span><span class="s">"512m"</span><span class="nt">/&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Standalone</strong> : standalone.conf</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> JAVA_OPTS="-Xms1024m -Xmx1024m -XX:MetaspaceSize=96M -XX:MaxMetaspaceSize=256m
</code></pre></div></div>

<h3 id="72-jconsole">7.2 JConsole</h3>
<p>:exclamation: Don’t use JDK Jconsole, use EAP_HOME/bin/jconsole.sh</p>

<p>Standalone:</p>

<ol>
  <li>
    <p>Enable JMX Remoting connector:</p>

    <blockquote>
      <p>Console : Configuration ⇒ Subsystems/Subsystem ⇒ JMX  ⇒  remoting-connector: jmx</p>
    </blockquote>
  </li>
  <li>
    <p>EAP_HOME/bin/jconsole.sh</p>
    <blockquote>
      <p>service:jmx:http-remoting-jmx://192.168.57.103:9990</p>
    </blockquote>
  </li>
</ol>

<h3 id="73-visualvm">7.3 VisualVM</h3>
<p>Todo</p>

<h2 id="8-security"><strong>8. Security</strong></h2>
<h3 id="rbac">RBAC</h3>

<p>RBAC i an access control provider that gives you the possiblity to map users and groups to roles(administrator, Monitor,etc). The Default “simple” access control don’t permit that.</p>

<p>Before Activating RBAC, Give Administrator authorization to admin user, else the console will be no longer accessible by this user :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/core-service=management/access=authorization/role-mapping=Administrator:add
/core-service=management/access=authorization/role-mapping=Administrator/include=user-jbossadmin:add(name=jbossadmin,type=USER)
</code></pre></div></div>

<p>RBAC roles:</p>
<ul>
  <li>Administrator</li>
  <li>Monitor</li>
  <li>Deployer</li>
  <li>Maintainer</li>
  <li>etc</li>
</ul>

<p>Switching To the RBAC Provider:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/core-service=management/access=authorization:write-attribute(name=provider,value=rbac)
reload
</code></pre></div></div>

<p>Create Users:</p>

<p>Use Console : Heading ‘Access Control’. Password is named Realm.</p>

<h3 id="legacy-authentication">Legacy Authentication</h3>
<p>Deprecated. No longer supported from Wildfly 25.</p>

<h3 id="elytron">Elytron</h3>

<h2 id="9-high-availability"><strong>9. High Availability</strong></h2>
<p>High availability can be guaranted by Load Balancing or Failover.</p>

<p>Cluster is made available by jgroup, infinspan and modcluster subsystems. <em>ha</em> and <em>full-ha</em> profiles enable these subsystems.</p>

<h3 id="cluster">Cluster</h3>
<p>Environment: Wildfly 29, Centos 7</p>

<p><img src="./images/Wildfly-29.-Cluster.drawio.png" alt="" /></p>

<p>⚠️ NOT recommended to set up domain controller and host controller on the same machine/vm.</p>

<ol>
  <li>
    <p><strong>Interface config on the Primary Host Controller</strong></p>

    <p><ins>host.xml</ins> : Master Host. IP 192.168.56.103</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">cp </span>host-primary.xml host.xml
</code></pre></div>    </div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;host</span> <span class="na">xmlns=</span><span class="s">"urn:jboss:domain:20.0"</span> <span class="na">name=</span><span class="s">"primary"</span><span class="nt">&gt;</span>
</code></pre></div>    </div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;domain-controller&gt;</span>
     <span class="nt">&lt;local/&gt;</span>
 <span class="nt">&lt;/domain-controller&gt;</span>
</code></pre></div>    </div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;interfaces&gt;</span>
     <span class="nt">&lt;interface</span> <span class="na">name=</span><span class="s">"management"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;inet-address</span> <span class="na">value=</span><span class="s">"${jboss.bind.address.management:192.168.56.103}"</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;/interface&gt;</span>
     <span class="nt">&lt;interface</span> <span class="na">name=</span><span class="s">"public"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;inet-address</span> <span class="na">value=</span><span class="s">"${jboss.bind.address:192.168.56.103}"</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;/interface&gt;</span>
 <span class="nt">&lt;/interfaces&gt;</span>
</code></pre></div>    </div>

    <p>On the primary host: with <strong>add-user.sh</strong> create a user <strong>centos2</strong> so that secondary host controller can be authenticated on the primary host controller.</p>
  </li>
  <li>
    <p><strong>Interface config on the Secondary Host Controller</strong></p>

    <p><ins>host.xml</ins> : Secondary Host. IP centos2/<strong>192.168.56.104</strong></p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">cp </span>host-secondary.xml host.xml
</code></pre></div>    </div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;host</span> <span class="na">xmlns=</span><span class="s">"urn:jboss:domain:20.0"</span> <span class="na">name=</span><span class="s">'centos2'</span><span class="nt">&gt;</span>
</code></pre></div>    </div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;domain-controller&gt;</span>
     <span class="nt">&lt;remote&gt;</span>
         <span class="nt">&lt;discovery-options&gt;</span>
             <span class="nt">&lt;static-discovery</span> <span class="na">name=</span><span class="s">"primary"</span> <span class="na">protocol=</span><span class="s">"remote+http"</span> <span class="na">host=</span><span class="s">"192.168.56.103"</span> <span class="na">port=</span><span class="s">"9990"</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/discovery-options&gt;</span>
     <span class="nt">&lt;/remote&gt;</span>
 <span class="nt">&lt;/domain-controller&gt;</span>
</code></pre></div>    </div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 	<span class="nt">&lt;interfaces&gt;</span>
     <span class="nt">&lt;interface</span> <span class="na">name=</span><span class="s">"management"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;inet-address</span> <span class="na">value=</span><span class="s">"${jboss.bind.address.management:192.168.56.104}"</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;/interface&gt;</span>
     <span class="nt">&lt;interface</span> <span class="na">name=</span><span class="s">"public"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;inet-address</span> <span class="na">value=</span><span class="s">"${jboss.bind.address:192.168.56.104}"</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;/interface&gt;</span>
 <span class="nt">&lt;/interfaces&gt;</span>
</code></pre></div>    </div>

    <p><strong>Authentication(Legacy)</strong>: no longer supported from Wildfly 25!</p>

    <p><strong>Authentication(Elytron)</strong>: <ins>host.xml</ins>.</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">"urn:wildfly:elytron:18.0"</span> <span class="na">final-providers=</span><span class="s">"combined-providers"</span> <span class="na">disallowed-providers=</span><span class="s">"OracleUcrypto"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;authentication-client&gt;</span>
         <span class="nt">&lt;authentication-configuration</span> <span class="na">sasl-mechanism-selector=</span><span class="s">"DIGEST-MD5"</span>
                               <span class="na">name=</span><span class="s">"hostAuthConfig"</span>
                               <span class="na">authentication-name=</span><span class="s">"centos2"</span>
                               <span class="na">realm=</span><span class="s">"ManagementRealm"</span><span class="nt">&gt;</span>
                 <span class="nt">&lt;credential-reference</span> <span class="na">clear-text=</span><span class="s">"changeit"</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/authentication-configuration&gt;</span>
         <span class="nt">&lt;authentication-context</span> <span class="na">name=</span><span class="s">"hcAuthContext"</span><span class="nt">&gt;</span>
                 <span class="nt">&lt;match-rule</span> <span class="na">authentication-configuration=</span><span class="s">"hostAuthConfig"</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/authentication-context&gt;</span>
     <span class="nt">&lt;/authentication-client&gt;</span>
     ...
</code></pre></div>    </div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;domain-controller&gt;</span>
     <span class="nt">&lt;remote</span> <span class="na">protocol=</span><span class="s">"remote+http"</span> <span class="na">host=</span><span class="s">"192.168.56.103"</span> <span class="na">port=</span><span class="s">"9990"</span> <span class="na">username=</span><span class="s">"centos2"</span> <span class="na">authentication-context=</span><span class="s">"hcAuthContext"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/domain-controller&gt;</span>
</code></pre></div>    </div>

    <p><strong>Mask the Password(Elytron)</strong>:</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>bin/elytron-tool.sh mask <span class="nt">--salt</span> 12345678 <span class="nt">--iteration</span> 256 <span class="nt">--secret</span> changeit
 MASK-2pr2SIUwzZyLvedad/aMuC<span class="p">;</span>12345678<span class="p">;</span>256
</code></pre></div>    </div>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">"urn:wildfly:elytron:18.0"</span> <span class="na">final-providers=</span><span class="s">"combined-providers"</span> <span class="na">disallowed-providers=</span><span class="s">"OracleUcrypto"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;authentication-client&gt;</span>
         <span class="nt">&lt;authentication-configuration</span> <span class="na">sasl-mechanism-selector=</span><span class="s">"DIGEST-MD5"</span>
                               <span class="na">name=</span><span class="s">"hostAuthConfig"</span>
                               <span class="na">authentication-name=</span><span class="s">"centos2"</span>
                               <span class="na">realm=</span><span class="s">"ManagementRealm"</span><span class="nt">&gt;</span>
             <span class="nt">&lt;credential-reference</span> <span class="na">clear-text=</span><span class="s">"MASK-2pr2SIUwzZyLvedad/aMuC;12345678;256"</span><span class="nt">/&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Create a server group with HA capabilities</strong></p>
  </li>
</ol>

<p><img src="images/wildfly-29-cluster2.png" alt="" /></p>

<p>Create Instances:</p>

<p><img src="images/wildfly-29-cluster3.png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```xml
```

```xml
```
</code></pre></div></div>

<h3 id="failover">Failover</h3>

<h2 id="10-miscs"><strong>10. Miscs</strong></h2>
<h3 id="jboss-eap-wildfly-and-jboss-as-versions">Jboss EAP, Wildfly and JBoss AS Versions</h3>

<table>
  <thead>
    <tr>
      <th>JBoss EAP</th>
      <th>Wildfly</th>
      <th>JBoss AS (Old)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>8.0 Beta</td>
      <td>27</td>
      <td>-</td>
    </tr>
    <tr>
      <td>7.4</td>
      <td>23</td>
      <td>-</td>
    </tr>
    <tr>
      <td>7.3</td>
      <td>18</td>
      <td>-</td>
    </tr>
    <tr>
      <td>7.0</td>
      <td>10</td>
      <td>-</td>
    </tr>
    <tr>
      <td>6.4</td>
      <td>-</td>
      <td>7.5</td>
    </tr>
    <tr>
      <td>6.0</td>
      <td>-</td>
      <td>7.1</td>
    </tr>
    <tr>
      <td>5.x</td>
      <td>-</td>
      <td>5.y</td>
    </tr>
    <tr>
      <td>4.x</td>
      <td>-</td>
      <td>4.y</td>
    </tr>
  </tbody>
</table>

<h2 id="11-common-errors"><strong>11. Common Errors</strong></h2>
<h3 id="fatal-boot-error-domain-cannot-start">Fatal Boot Error: Domain cannot start</h3>
<p>Start the the domain controller in ADMIN-ONLY mode and correct the error</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./domain.sh  --admin-only ...
</code></pre></div></div>

<h2 id="12-references"><strong>12. References</strong></h2>
<ul>
  <li>https://www.jtips.info/WildFly</li>
</ul>

		</div>
	</div>
	
</div>
    <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        🍪 &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


</div>
<script src="https://consent.cookiebot.com/uc.js" data-cbid="900808a8-f178-4994-b2ad-66bf3ccca5f7" data-blockingmode="auto" strategy="beforeInteractive"></script>
<script src="http://localhost:4000/assets/js/matomo-tag-manager.js"></script>
<script src="http://localhost:4000/assets/js/matomo-analytics.js"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="http://localhost:4000/assets/js/analytics.js"></script>
<script src="http://localhost:4000/assets/js/greedynav.js"></script>
</body>
</html>
