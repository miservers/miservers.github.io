## Interrupts
* Miscellaneous  
  - when an interrupt is handled, IF flag is cleared, which disable maskable interrupts.
  
* Interrupt Types:  
  
  1.1. Hardware interrupts  
  **NMI**: non maskable, received on the processor's NMI# input pin.  
  **INTR**: extern I/O intrrupts. maskable(ignored) if 'IF' flag is clear. received on the processor's INTR# input pin.  
  **Exceptions**: they occur when the processor detect an error while executing an instruction(division by 0, page fault, gpf,etc)

![](../../documentation/images/Kernel-PIC-8259A.png)

  1.2. Software interrupt: generated by "INT n" instruction.

* IDT: table of 256 vectors.   
  0-31 vectors are asigned to NMI and exceptions. non-maskable.  
  32-47 are asigned to material interrupts(IRQ). maskable.  
  48-255 are available for kernel. maskable.  

**IDTR and IDT**  
![](../../documentation/images/Kernel-IDTR-IDT.png)

**IDT descriptor**  
![](../../documentation/images/Kernel-IDT-Interrupt-Gate.png)

IDT maximum size 256Ã—8=2048=2KB

**ERROR CODE**  
When an exception condition is related to a specific segment, the processor pushes an error code
onto the stack of the exception handler.
![](../../documentation/images/Kernel-IDT-ErrorCode.png)


### Diagramme de sequence pour interruption materielle IRQ_1
~~~
Keyboard    PIC    sys_call.S                           keyboard.c             
  |--------->|         |                                    |
  |          |--INTR-->|                                    |
  |          |         |--irq_1-->|                         |
  |          |<--ACK---|          |---keyborad_handler----->|
  |          |         |          |                         |
~~~


### Keyboard - 8042 - PS/2 controller  
![](../../documentation/images/Kernel-Kbd-8042_PS2_Controller.png)
![](../../documentation/images/Kernel-Kbd-8042_PS2_Controller2.png)

    

### Timer PIT 8253 - Programmable Interrupt Timer

![](../../documentation/images/Kernel-Timer-PIT8253.png)

Each pins (CLK, GATE, OUT) is associated with an counter. PIT 8253 has 3 separate counters.

- **CLK**: in clock frenquence.
- **OUT**: out frequence.
- **GATE**: enable/disable a counter.

- **D0-D7**: allow to processor to access the PIT internal registers.




## References 
- **Intel Architecture - System Programming Guide.pdf**  
- https://wiki.osdev.org/%228042%22_PS/2_Controller
- http://lacl.univ-paris12.fr/cegielski/bios/ch8.pdf

  

